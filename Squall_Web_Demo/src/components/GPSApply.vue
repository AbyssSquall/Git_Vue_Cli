<template>
    <div >
        <div class="squall_Map">
          <div id="map" style="height:100%"></div>
        </div>
    </div>
</template>
<script>
import {Map} from "@/lib/squall_map/leaflet_base"

export default {
  name: 'Car',
  data () {
    return {
      msg: 'Welcome to Your Vue.js App',
      page: 'car',
      PageHeight:100,
      PageWidth:100,
    }
  },
  components: {
  },
  mounted:function(){
    //路径
    var Route_SY_WC = [{lat: 30.48900672052744, lng: 114.3036851050731},
    {lat: 30.489028178199952, lng: 114.30518177773132},
    {lat: 30.489076457963122, lng: 114.30533734585708},
    {lat: 30.489478789322863, lng: 114.30603472021397},
    {lat: 30.489462696068472, lng: 114.3063136699567},
    {lat: 30.489505611413502, lng: 114.30669990806207},
    {lat: 30.48966117953928, lng: 114.30695203571418},
    {lat: 30.489725552556834, lng: 114.30699495105922},
    {lat: 30.48975773906561, lng: 114.3073329094014},
    {lat: 30.48976310348374, lng: 114.30745629101835},
    {lat: 30.490401469241196, lng: 114.30727926522007},
    {lat: 30.490717969910854, lng: 114.30722025662067},
    {lat: 30.491533361466598, lng: 114.3072631719657},
    {lat: 30.492498956729968, lng: 114.30748847752716},
    {lat: 30.493759594990482, lng: 114.30783180028743},
    {lat: 30.4944998846924, lng: 114.30820730955656},
    {lat: 30.49524017439432, lng: 114.30865255626134},
    {lat: 30.496146761058263, lng: 114.30921582016494},
    {lat: 30.496570550090524, lng: 114.30946794781704},
    {lat: 30.497182093757328, lng: 114.30965033803346},
    {lat: 30.497664891389014, lng: 114.3097254398873},
    {lat: 30.49837299458215, lng: 114.30972007546916},
    {lat: 30.49908646219342, lng: 114.30965570245161},
    {lat: 30.499435149371866, lng: 114.30963424477909},
    {lat: 30.499746285623395, lng: 114.3095645073434},
    {lat: 30.500202261164432, lng: 114.30940357479949},
    {lat: 30.50064214345108, lng: 114.30924264225558},
    {lat: 30.50174721358583, lng: 114.30884031089585},
    {lat: 30.5019939768198, lng: 114.3087383869514},
    {lat: 30.50310977579081, lng: 114.30841652186359},
    {lat: 30.503388725533565, lng: 114.30833069117352},
    {lat: 30.504912220282442, lng: 114.30823949606531},
    {lat: 30.506703935937807, lng: 114.30836287768233},
    {lat: 30.508608304373908, lng: 114.30844334395425},
    {lat: 30.510142527959044, lng: 114.30849698813557},
    {lat: 30.51199325221384, lng: 114.3085774544075},
    {lat: 30.513184153038672, lng: 114.30859354766187},
    {lat: 30.513393365345735, lng: 114.30859354766187},
    {lat: 30.515211903091753, lng: 114.30868474277008},
    {lat: 30.515276276109308, lng: 114.31399551671865},
    {lat: 30.51561423445149, lng: 114.31398478788236},
    {lat: 30.516848050621356, lng: 114.3135717276864},
    {lat: 30.517808281466603, lng: 114.31329814236176},
    {lat: 30.519058190890856, lng: 114.3133410577068},
    {lat: 30.51985748919221, lng: 114.31366828721275},
    {lat: 30.520216905206905, lng: 114.31385604184726},
    {lat: 30.520565592385342, lng: 114.31406525415434},
    {lat: 30.52100011025386, lng: 114.31421545786196},
    {lat: 30.521654569265706, lng: 114.31419936460759},
    {lat: 30.522368036876976, lng: 114.3140598897362},
    {lat: 30.52285083450866, lng: 114.3139901523005},
    {lat: 30.52362331071936, lng: 114.31430665297017},
    {lat: 30.524819575962322, lng: 114.31466606898488},
    {lat: 30.525731527044393, lng: 114.31492892547323},
    {lat: 30.526267968857375, lng: 114.31509522243527},
    {lat: 30.526654206962725, lng: 114.3153044347423},
    {lat: 30.52778073476999, lng: 114.3162914876782},
    {lat: 30.528150879620956, lng: 114.31661335276601},
    {lat: 30.528349363091756, lng: 114.31679574298244},
    {lat: 30.528601490743863, lng: 114.31693521785382},
    {lat: 30.528982364431084, lng: 114.31696740436257},
    {lat: 30.529041373030513, lng: 114.31686011599999},
    {lat: 30.529046737448642, lng: 114.3164631490584},
    {lat: 30.52908965279368, lng: 114.31611982629806},
    {lat: 30.529132568138717, lng: 114.31591597840912},
    {lat: 30.52922376324693, lng: 114.31559411332137},
    {lat: 30.52932568719139, lng: 114.31531516357859},
    {lat: 30.52943297555399, lng: 114.31505230709024},
    {lat: 30.52955099275285, lng: 114.31478945060184},
    {lat: 30.529631459024788, lng: 114.31460169596733},
    {lat: 30.529631459024788, lng: 114.31447831435031},
    {lat: 30.52959927251601, lng: 114.3139901523005}]

    var map_option = {
      "ID":"map",
      "Plugin":["leaflet_gps"],
    };

    var squall_map = new Map(map_option);

    squall_map.Plugin.GPS({
      "map":squall_map
    });

    squall_map.Plugin.Guide();

    squall_map.locate({
      setView: true,
      maxZoom: 18
    });

    squall_map.on('locationfound', function(e) {
      //alert(e.latlng);

      //将自己所在的点加入路径
      Route_SY_WC.splice(0,0,{lat:e.latlng.lat,lng:e.latlng.lng});
      
      //在地图上显示路径
      var squall_graph_option_line = {
        LayerID:"PolygonExample_line",
        Type:"line",
        PointArray:[[Route_SY_WC]],
        LineStyle:{color: '#1e50a2',weight:2.0,fillOpacity:0.5}
      };
      squall_map.AddGraph(squall_graph_option_line);

      //Route_SY_WC
      //var radius = e.accuracy / 2;
      //L.marker(e.latlng).addTo(squall_map).bindPopup("你就在这个圈内");
      //L.circle(e.latlng, radius).addTo(squall_map);
    });

    squall_map.on('locationerror', function(e) {

      // var squall_graph_option_line = {
      //   LayerID:"PolygonExample_line",
      //   Type:"line",
      //   PointArray:[[Route_SY_WC]],
      //   LineStyle:{color: '#1e50a2',weight:2.0,fillOpacity:0.5}
      // };
      // squall_map.AddGraph(squall_graph_option_line);

      console.log('定位出错=====>', e.message);
    });

    //循环运行导航
    setInterval(function(){

    },5000);
  },
}
</script>

